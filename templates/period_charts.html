{% extends "base.html" %}
{% block content %}

<h2 style="text-align:center; margin-top:20px;">ðŸ“Š Period Charts</h2>

<div id="charts-container">

    <!-- Top Left -->
    <div class="period-card chart-card">
        <h4>Cycle Length Trend</h4>
        <canvas id="cycleLengthChart"></canvas>
    </div>

    <!-- Top Right -->
    <div class="period-card chart-card">
        <h4>Period Duration Trend</h4>
        <canvas id="periodDurationChart"></canvas>
    </div>

    <!-- Bottom Left -->
    <div class="period-card chart-card">
        <h4>Symptoms Frequency</h4>
        <canvas id="symptomsChart"></canvas>
    </div>

    <!-- Bottom Right -->
    <div class="period-card chart-card">
        <h4>Cycle Phase Distribution</h4>
        <canvas id="phaseChart"></canvas>
    </div>

    <!-- Back Button -->
    <div class="back-btn-wrapper">
        <a href="/period" class="back-btn">â¬… Back</a>
    </div>

</div>

<style>
#charts-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 25px;
}

/* ================= CARDS ================= */
.period-card {
    background: #fff5f8;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.period-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

.period-card h4 {
    text-align: center;
    margin-bottom: 12px;
}

/* ================= CHART CARDS ================= */
.chart-card {
    min-height: 360px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* ================= PIE CHART ================= */
#phaseChart {
    max-width: 260px;
    max-height: 260px;
    margin: auto;
}

/* ================= BACK BUTTON ================= */
.back-btn-wrapper {
    grid-column: span 2;
    text-align: center;
    margin-top: 15px;
}

.back-btn {
    padding: 10px 22px;
    font-size: 14px;
    background: #6c5ce7;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    display: inline-block;
    box-shadow: 0 4px 12px rgba(108,92,231,0.3);
}

.back-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(108,92,231,0.4);
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
    #charts-container {
        grid-template-columns: 1fr;
    }
    .back-btn-wrapper {
        grid-column: span 1;
    }
}
</style>

<!-- ================= CHART.JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const dates = JSON.parse('{{ dates|tojson|safe }}');
const cycle_lengths = JSON.parse('{{ cycle_lengths|tojson|safe }}');
const period_durations = JSON.parse('{{ period_durations|tojson|safe }}');
const symptoms_labels = JSON.parse('{{ symptoms_count.keys()|list|tojson|safe }}');
const symptoms_values = JSON.parse('{{ symptoms_count.values()|list|tojson|safe }}');
const phase_labels = JSON.parse('{{ phase_count.keys()|list|tojson|safe }}');
const phase_values = JSON.parse('{{ phase_count.values()|list|tojson|safe }}');

/* Cycle Length */
new Chart(document.getElementById("cycleLengthChart"), {
    type: "line",
    data: {
        labels: dates,
        datasets: [{
            label: "Cycle Length",
            data: cycle_lengths,
            borderColor: "#ff6b81",
            backgroundColor: "rgba(255,107,129,0.2)",
            fill: true,
            tension: 0.3
        }]
    },
    options: { responsive:true }
});

/* Period Duration */
new Chart(document.getElementById("periodDurationChart"), {
    type: "line",
    data: {
        labels: dates,
        datasets: [{
            label: "Period Duration",
            data: period_durations,
            borderColor: "#6c5ce7",
            backgroundColor: "rgba(108,92,231,0.2)",
            fill: true,
            tension: 0.3
        }]
    },
    options: { responsive:true }
});

/* Symptoms */
new Chart(document.getElementById("symptomsChart"), {
    type: "bar",
    data: {
        labels: symptoms_labels,
        datasets: [{
            label: "Frequency",
            data: symptoms_values,
            backgroundColor: "rgba(255,99,132,0.6)"
        }]
    },
    options: { responsive:true }
});

/* Cycle Phase */
new Chart(document.getElementById("phaseChart"), {
    type: "pie",
    data: {
        labels: phase_labels,
        datasets: [{
            data: phase_values,
            backgroundColor: ["#ff6b81", "#6c5ce7", "#00b894", "#fdcb6e"]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
</script>

{% endblock %}
